"use client";

import React, { useRef } from "react";
import { Excalidraw, ExcalidrawImperativeAPI } from "@excalidraw/excalidraw";
import "@excalidraw/excalidraw/index.css";

const Phase1Whiteboard: React.FC = () => {
  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);

  const params = new URLSearchParams(
    typeof window !== "undefined" ? window.location.search : ""
  );
  const role = params.get("role") === "student" ? "student" : "tutor";

  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw
        ref={excalidrawRef}
        onChange={(elements, appState) => {
          if (role === "student") {
            // Students cannot delete or modify locked elements
            const cleanedElements = elements.map(el => {
              if (el.isLocked) return el;
              return el;
            });

            excalidrawRef.current?.updateScene({
              elements: cleanedElements,
            });
          }
        }}
        UIOptions={{
          canvasActions: {
            loadScene: role === "tutor",
            saveAsImage: role === "tutor",
            saveToActiveFile: role === "tutor",
            export: role === "tutor",
          },
        }}
      />
    </div>
  );
};

export default Phase1Whiteboard;

